# Authentication API Paths
# Base path: /api/auth/v1

register:
  post:
    tags:
      - Authentication
    summary: Register new user
    description: |
      Create a new user account with email and password.
      Rate limited to 5 requests per hour per IP.
    operationId: register
    security: []
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '../schemas/auth.yaml#/RegisterRequest'
    responses:
      '200':
        description: Registration successful
        content:
          application/json:
            schema:
              $ref: '../schemas/auth.yaml#/AuthResponse'
      '400':
        description: Invalid input or password requirements not met
        content:
          application/json:
            schema:
              $ref: '../schemas/error.yaml#/ValidationError'
      '409':
        description: Email already registered
        content:
          application/json:
            schema:
              $ref: '../schemas/error.yaml#/Error'
      '429':
        description: Too many registration attempts
        content:
          application/json:
            schema:
              $ref: '../schemas/error.yaml#/Error'

login:
  post:
    tags:
      - Authentication
    summary: Login with email/password
    description: |
      Authenticate user with email and password.
      Rate limited: 5 attempts per 5 minutes, 15-minute block after exceeded.
    operationId: login
    security: []
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '../schemas/auth.yaml#/LoginRequest'
    responses:
      '200':
        description: Login successful or 2FA required
        content:
          application/json:
            schema:
              $ref: '../schemas/auth.yaml#/AuthResponse'
      '401':
        description: Invalid credentials
        content:
          application/json:
            schema:
              $ref: '../schemas/error.yaml#/Error'
      '423':
        description: Account locked due to too many failed attempts
        content:
          application/json:
            schema:
              $ref: '../schemas/error.yaml#/Error'
      '429':
        description: Too many login attempts
        content:
          application/json:
            schema:
              $ref: '../schemas/error.yaml#/Error'

login-2fa:
  post:
    tags:
      - Authentication
      - MFA
    summary: Complete login with 2FA code
    description: |
      Complete login by providing 2FA code after initial login returned requiresTwoFactor=true.
      Rate limited: 5 attempts per 5 minutes per IP.
    operationId: loginWith2FA
    security: []
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '../schemas/auth.yaml#/TwoFactorLoginRequest'
    responses:
      '200':
        description: 2FA verification successful
        content:
          application/json:
            schema:
              $ref: '../schemas/auth.yaml#/AuthResponse'
      '401':
        description: Invalid 2FA code or token
        content:
          application/json:
            schema:
              $ref: '../schemas/error.yaml#/Error'
      '429':
        description: Too many 2FA attempts
        content:
          application/json:
            schema:
              $ref: '../schemas/error.yaml#/Error'

logout:
  post:
    tags:
      - Authentication
    summary: Logout and revoke tokens
    description: Invalidate current session tokens
    operationId: logout
    security:
      - BearerAuth: []
    responses:
      '200':
        description: Logout successful
      '401':
        description: Not authenticated
        content:
          application/json:
            schema:
              $ref: '../schemas/error.yaml#/Error'

# Token Management

token-refresh:
  post:
    tags:
      - Authentication
      - Token
    summary: Refresh access token
    description: |
      Exchange refresh token for new access token.
      Rate limited: 30 requests per minute per IP.
      Refresh tokens are rotated on each use.
    operationId: refreshToken
    security: []
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '../schemas/auth.yaml#/RefreshTokenRequest'
    responses:
      '200':
        description: Token refreshed successfully
        content:
          application/json:
            schema:
              $ref: '../schemas/auth.yaml#/TokenResponse'
      '401':
        description: Invalid or expired refresh token
        content:
          application/json:
            schema:
              $ref: '../schemas/error.yaml#/Error'

token-validate:
  post:
    tags:
      - Authentication
      - Token
    summary: Validate JWT token
    description: |
      Validate a JWT token and return user information.
      Rate limited: 100 requests per minute per IP.
    operationId: validateToken
    security: []
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '../schemas/auth.yaml#/TokenValidationRequest'
    responses:
      '200':
        description: Token validation result
        content:
          application/json:
            schema:
              $ref: '../schemas/auth.yaml#/TokenValidationResponse'

token-revoke:
  post:
    tags:
      - Authentication
      - Token
    summary: Revoke a specific token
    description: |
      Revoke a specific token.
      Rate limited: 10 requests per minute per user.
    operationId: revokeToken
    security:
      - BearerAuth: []
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '../schemas/auth.yaml#/RevokeTokenRequest'
    responses:
      '200':
        description: Token revoked
      '401':
        description: Not authenticated
        content:
          application/json:
            schema:
              $ref: '../schemas/error.yaml#/Error'

token-revoke-all:
  post:
    tags:
      - Authentication
      - Token
    summary: Revoke all tokens for current user
    description: |
      Revoke all tokens for the authenticated user (except the current token).
      Rate limited: 5 requests per 5 minutes per user.
    operationId: revokeAllTokens
    security:
      - BearerAuth: []
    responses:
      '200':
        description: All tokens revoked
      '401':
        description: Not authenticated
        content:
          application/json:
            schema:
              $ref: '../schemas/error.yaml#/Error'

# Password Management

password-forgot:
  post:
    tags:
      - Authentication
      - Password
    summary: Request password reset
    description: |
      Send password reset link to email.
      Rate limited: 3 requests per hour per IP.
      Always returns success to prevent email enumeration.
    operationId: forgotPassword
    security: []
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '../schemas/auth.yaml#/ForgotPasswordRequest'
    responses:
      '200':
        description: Reset email sent if account exists
        content:
          application/json:
            schema:
              $ref: '../schemas/auth.yaml#/MessageResponse'
      '429':
        description: Too many reset requests
        content:
          application/json:
            schema:
              $ref: '../schemas/error.yaml#/Error'

password-reset:
  post:
    tags:
      - Authentication
      - Password
    summary: Reset password with token
    description: |
      Set new password using reset token from email.
      Rate limited: 5 requests per hour per IP.
    operationId: resetPassword
    security: []
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '../schemas/auth.yaml#/ResetPasswordRequest'
    responses:
      '200':
        description: Password reset successful
        content:
          application/json:
            schema:
              $ref: '../schemas/auth.yaml#/MessageResponse'
      '400':
        description: Invalid or expired token
        content:
          application/json:
            schema:
              $ref: '../schemas/error.yaml#/Error'

password-change:
  post:
    tags:
      - Authentication
      - Password
    summary: Change password (authenticated)
    description: |
      Change password for authenticated user.
      Rate limited: 5 requests per hour per user.
    operationId: changePassword
    security:
      - BearerAuth: []
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '../schemas/auth.yaml#/ChangePasswordRequest'
    responses:
      '200':
        description: Password changed successfully
        content:
          application/json:
            schema:
              $ref: '../schemas/auth.yaml#/MessageResponse'
      '400':
        description: Password requirements not met
        content:
          application/json:
            schema:
              $ref: '../schemas/error.yaml#/ValidationError'
      '401':
        description: Current password incorrect
        content:
          application/json:
            schema:
              $ref: '../schemas/error.yaml#/Error'

# Two-Factor Authentication

2fa-setup:
  post:
    tags:
      - Authentication
      - MFA
    summary: Setup 2FA - get QR code
    description: |
      Initialize 2FA setup and return TOTP secret with QR code.
      Rate limited: 10 requests per hour per user.
    operationId: setup2FA
    security:
      - BearerAuth: []
    responses:
      '200':
        description: 2FA setup initiated
        content:
          application/json:
            schema:
              $ref: '../schemas/auth.yaml#/TwoFactorSetupResponse'
      '400':
        description: 2FA already enabled
        content:
          application/json:
            schema:
              $ref: '../schemas/error.yaml#/Error'

2fa-enable:
  post:
    tags:
      - Authentication
      - MFA
    summary: Enable 2FA after verification
    description: |
      Verify TOTP code to complete 2FA setup.
      Returns backup codes on success.
      Rate limited: 5 requests per 5 minutes per user.
    operationId: enable2FA
    security:
      - BearerAuth: []
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '../schemas/auth.yaml#/TwoFactorEnableRequest'
    responses:
      '200':
        description: 2FA enabled successfully
        content:
          application/json:
            schema:
              $ref: '../schemas/auth.yaml#/TwoFactorEnableResponse'
      '401':
        description: Invalid 2FA code
        content:
          application/json:
            schema:
              $ref: '../schemas/error.yaml#/Error'

2fa-disable:
  post:
    tags:
      - Authentication
      - MFA
    summary: Disable 2FA
    description: |
      Disable 2FA for current user (requires 2FA code and password).
      Rate limited: 3 requests per hour per user.
    operationId: disable2FA
    security:
      - BearerAuth: []
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '../schemas/auth.yaml#/TwoFactorDisableRequest'
    responses:
      '200':
        description: 2FA disabled
        content:
          application/json:
            schema:
              $ref: '../schemas/auth.yaml#/MessageResponse'
      '401':
        description: Invalid password or 2FA code
        content:
          application/json:
            schema:
              $ref: '../schemas/error.yaml#/Error'

2fa-backup-codes:
  post:
    tags:
      - Authentication
      - MFA
    summary: Generate new backup codes
    description: |
      Generate new backup codes (invalidates previous codes).
      Rate limited: 3 requests per hour per user.
    operationId: generateBackupCodes
    security:
      - BearerAuth: []
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '../schemas/auth.yaml#/TwoFactorVerifyRequest'
    responses:
      '200':
        description: New backup codes generated
        content:
          application/json:
            schema:
              $ref: '../schemas/auth.yaml#/BackupCodesResponse'
      '401':
        description: Invalid 2FA code
        content:
          application/json:
            schema:
              $ref: '../schemas/error.yaml#/Error'

# OAuth

oauth-login:
  post:
    tags:
      - Authentication
      - OAuth2
    summary: Login/register with OAuth provider
    description: |
      Authenticate using OAuth provider (google, facebook, github, apple).
      Creates account if user doesn't exist.
      Rate limited: 10 requests per minute per IP.
    operationId: oauthLogin
    security: []
    parameters:
      - name: provider
        in: path
        required: true
        schema:
          type: string
          enum: [google, facebook, github, apple]
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '../schemas/auth.yaml#/OAuthRequest'
    responses:
      '200':
        description: OAuth authentication successful
        content:
          application/json:
            schema:
              $ref: '../schemas/auth.yaml#/AuthResponse'
      '400':
        description: Invalid OAuth code or configuration
        content:
          application/json:
            schema:
              $ref: '../schemas/error.yaml#/Error'

oauth-link:
  post:
    tags:
      - Authentication
      - OAuth2
    summary: Link OAuth provider to existing account
    description: |
      Link an OAuth provider to the current user's account.
      Rate limited: 5 requests per hour per user.
    operationId: linkOAuthProvider
    security:
      - BearerAuth: []
    parameters:
      - name: provider
        in: path
        required: true
        schema:
          type: string
          enum: [google, facebook, github, apple]
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '../schemas/auth.yaml#/OAuthRequest'
    responses:
      '200':
        description: Provider linked successfully
        content:
          application/json:
            schema:
              $ref: '../schemas/auth.yaml#/MessageResponse'
      '400':
        description: Provider already linked
        content:
          application/json:
            schema:
              $ref: '../schemas/error.yaml#/Error'

oauth-unlink:
  delete:
    tags:
      - Authentication
      - OAuth2
    summary: Unlink OAuth provider from account
    description: |
      Unlink an OAuth provider from the current user's account.
      Cannot unlink the last authentication method.
      Rate limited: 5 requests per hour per user.
    operationId: unlinkOAuthProvider
    security:
      - BearerAuth: []
    parameters:
      - name: provider
        in: path
        required: true
        schema:
          type: string
          enum: [google, facebook, github, apple]
    responses:
      '200':
        description: Provider unlinked successfully
        content:
          application/json:
            schema:
              $ref: '../schemas/auth.yaml#/MessageResponse'
      '400':
        description: Cannot unlink last authentication method
        content:
          application/json:
            schema:
              $ref: '../schemas/error.yaml#/Error'

# OAuth2 Additional Endpoints

oauth2-providers:
  get:
    tags:
      - OAuth2
    summary: Get available OAuth2 providers
    description: Get list of available OAuth2 providers with their authorization URLs
    operationId: getOAuth2Providers
    security: []
    responses:
      '200':
        description: List of available providers
        content:
          application/json:
            schema:
              $ref: '../schemas/auth.yaml#/OAuth2ProvidersResponse'

oauth2-linked:
  get:
    tags:
      - OAuth2
    summary: Get linked OAuth2 providers for current user
    description: Get list of OAuth2 providers linked to the current user's account
    operationId: getLinkedProviders
    security:
      - BearerAuth: []
    responses:
      '200':
        description: Linked providers
        content:
          application/json:
            schema:
              $ref: '../schemas/auth.yaml#/LinkedProvidersResponse'

oauth2-authorize:
  get:
    tags:
      - OAuth2
    summary: Get authorization URL for OAuth2 provider
    description: Get the authorization URL for a specific OAuth2 provider
    operationId: getAuthorizationUrl
    security: []
    parameters:
      - name: provider
        in: path
        required: true
        schema:
          type: string
          enum: [google, facebook, github, apple]
      - name: redirectUri
        in: query
        required: false
        schema:
          type: string
          format: uri
    responses:
      '200':
        description: Authorization URL
        content:
          application/json:
            schema:
              $ref: '../schemas/auth.yaml#/AuthorizationUrlResponse'

# Sessions

sessions:
  get:
    tags:
      - Authentication
      - Sessions
    summary: Get active sessions
    description: |
      Get all active sessions for current user.
      Rate limited: 30 requests per minute per user.
    operationId: getSessions
    security:
      - BearerAuth: []
    responses:
      '200':
        description: List of active sessions
        content:
          application/json:
            schema:
              $ref: '../schemas/auth.yaml#/SessionsResponse'

session-terminate:
  delete:
    tags:
      - Authentication
      - Sessions
    summary: Terminate specific session
    description: |
      Terminate a specific session by ID.
      Rate limited: 10 requests per minute per user.
    operationId: terminateSession
    security:
      - BearerAuth: []
    parameters:
      - name: sessionId
        in: path
        required: true
        schema:
          type: string
    responses:
      '200':
        description: Session terminated
      '404':
        description: Session not found
        content:
          application/json:
            schema:
              $ref: '../schemas/error.yaml#/Error'

sessions-terminate-all:
  delete:
    tags:
      - Authentication
      - Sessions
    summary: Terminate all other sessions
    description: |
      Terminate all sessions except current.
      Rate limited: 5 requests per 5 minutes per user.
    operationId: terminateAllSessions
    security:
      - BearerAuth: []
    responses:
      '200':
        description: All other sessions terminated

# Phone OTP

phone-request-otp:
  post:
    tags:
      - Authentication
      - Phone OTP
    summary: Request OTP
    description: |
      Request a one-time password sent via SMS.
      Rate limits: 5 per day per phone, 10 per hour per IP.
    operationId: requestPhoneOtp
    security: []
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '../schemas/auth.yaml#/PhoneOtpRequest'
    responses:
      '200':
        description: OTP sent successfully
        content:
          application/json:
            schema:
              $ref: '../schemas/auth.yaml#/OtpResponse'
      '400':
        description: Invalid phone number or rate limit exceeded
        content:
          application/json:
            schema:
              $ref: '../schemas/auth.yaml#/OtpResponse'

phone-verify-otp:
  post:
    tags:
      - Authentication
      - Phone OTP
    summary: Verify OTP
    description: Verify the OTP code without logging in
    operationId: verifyPhoneOtp
    security: []
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '../schemas/auth.yaml#/PhoneVerifyRequest'
    responses:
      '200':
        description: OTP verified
        content:
          application/json:
            schema:
              $ref: '../schemas/auth.yaml#/OtpResponse'
      '400':
        description: Invalid or expired OTP
        content:
          application/json:
            schema:
              $ref: '../schemas/auth.yaml#/OtpResponse'

phone-login:
  post:
    tags:
      - Authentication
      - Phone OTP
    summary: Login with OTP
    description: |
      Verify OTP and login. Creates account if phone number is new.
    operationId: phoneLogin
    security: []
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '../schemas/auth.yaml#/PhoneLoginRequest'
    responses:
      '200':
        description: Login successful
        content:
          application/json:
            schema:
              $ref: '../schemas/auth.yaml#/OtpResponse'
      '400':
        description: Invalid OTP
        content:
          application/json:
            schema:
              $ref: '../schemas/auth.yaml#/OtpResponse'

phone-resend-otp:
  post:
    tags:
      - Authentication
      - Phone OTP
    summary: Resend OTP
    description: |
      Resend OTP to the same phone number.
      Cooldown: 60 seconds between resends.
    operationId: resendPhoneOtp
    security: []
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '../schemas/auth.yaml#/PhoneOtpRequest'
    responses:
      '200':
        description: OTP resent
        content:
          application/json:
            schema:
              $ref: '../schemas/auth.yaml#/OtpResponse'
      '400':
        description: Cooldown not elapsed
        content:
          application/json:
            schema:
              $ref: '../schemas/auth.yaml#/OtpResponse'

# ==================== Extended 2FA Endpoints ====================

2fa-status:
  get:
    tags:
      - MFA
    summary: Get 2FA status
    description: Check if two-factor authentication is enabled for the current user
    operationId: get2FAStatus
    security:
      - BearerAuth: []
    responses:
      '200':
        description: 2FA status
        content:
          application/json:
            schema:
              type: object
              properties:
                enabled:
                  type: boolean
                hasBackupCodes:
                  type: boolean
                backupCodesCount:
                  type: integer
                setupPending:
                  type: boolean

2fa-setup-cancel:
  post:
    tags:
      - MFA
    summary: Cancel 2FA setup
    description: Cancel a pending 2FA setup before it's enabled
    operationId: cancel2FASetup
    security:
      - BearerAuth: []
    responses:
      '200':
        description: Setup cancelled
        content:
          application/json:
            schema:
              $ref: '../schemas/auth.yaml#/MessageResponse'
      '400':
        description: 2FA already enabled
        content:
          application/json:
            schema:
              $ref: '../schemas/error.yaml#/Error'

2fa-backup-codes-count:
  get:
    tags:
      - MFA
    summary: Get remaining backup codes count
    description: Returns the number of unused backup codes remaining
    operationId: getBackupCodesCount
    security:
      - BearerAuth: []
    responses:
      '200':
        description: Backup codes count
        content:
          application/json:
            schema:
              type: object
              properties:
                remainingCodes:
                  type: integer
                lowCodesWarning:
                  type: boolean
                message:
                  type: string
      '400':
        description: 2FA not enabled
        content:
          application/json:
            schema:
              $ref: '../schemas/error.yaml#/Error'

2fa-verify:
  post:
    tags:
      - MFA
    summary: Verify 2FA code
    description: Verify a TOTP code without performing any action. Useful for testing setup.
    operationId: verify2FACode
    security:
      - BearerAuth: []
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '../schemas/auth.yaml#/TwoFactorVerifyRequest'
    responses:
      '200':
        description: Verification result
        content:
          application/json:
            schema:
              type: object
              properties:
                valid:
                  type: boolean
                message:
                  type: string
      '400':
        description: 2FA not enabled
        content:
          application/json:
            schema:
              $ref: '../schemas/error.yaml#/Error'

2fa-recover:
  post:
    tags:
      - MFA
    summary: Use backup code for recovery
    description: Use a backup code when authenticator app is unavailable. Each backup code can only be used once.
    operationId: useBackupCode
    security:
      - BearerAuth: []
    requestBody:
      required: true
      content:
        application/json:
          schema:
            type: object
            required:
              - backupCode
            properties:
              backupCode:
                type: string
                pattern: '^\d{4}-\d{4}$'
                description: Backup code in format XXXX-XXXX
    responses:
      '200':
        description: Backup code accepted
        content:
          application/json:
            schema:
              type: object
              properties:
                success:
                  type: boolean
                message:
                  type: string
                remainingCodes:
                  type: integer
      '400':
        description: Invalid backup code
        content:
          application/json:
            schema:
              $ref: '../schemas/error.yaml#/Error'

# ==================== Extended Token Endpoints ====================

token-info:
  get:
    tags:
      - Token
    summary: Get current token info
    description: Get information about the current access token
    operationId: getTokenInfo
    security:
      - BearerAuth: []
    responses:
      '200':
        description: Token information
        content:
          application/json:
            schema:
              type: object
              properties:
                userId:
                  type: string
                  format: uuid
                email:
                  type: string
                  format: email
                sessionId:
                  type: string
                  format: uuid
                tokenType:
                  type: string
                issuedAt:
                  type: string
                  format: date-time
                expiresAt:
                  type: string
                  format: date-time
                valid:
                  type: boolean
                remainingSeconds:
                  type: integer

token-active:
  get:
    tags:
      - Token
    summary: List active refresh tokens
    description: Get a list of all active (non-revoked, non-expired) refresh tokens for the current user
    operationId: getActiveTokens
    security:
      - BearerAuth: []
    responses:
      '200':
        description: Active tokens list
        content:
          application/json:
            schema:
              type: object
              properties:
                userId:
                  type: string
                  format: uuid
                activeTokenCount:
                  type: integer
                tokens:
                  type: array
                  items:
                    type: object
                    properties:
                      id:
                        type: string
                        format: uuid
                      deviceId:
                        type: string
                      deviceName:
                        type: string
                      ipAddress:
                        type: string
                      createdAt:
                        type: string
                        format: date-time
                      expiresAt:
                        type: string
                        format: date-time
                      oauthProvider:
                        type: string

token-count:
  get:
    tags:
      - Token
    summary: Get active token count
    description: Returns the number of active refresh tokens for the current user
    operationId: getTokenCount
    security:
      - BearerAuth: []
    responses:
      '200':
        description: Token count
        content:
          application/json:
            schema:
              type: object
              properties:
                activeTokens:
                  type: integer

token-history:
  get:
    tags:
      - Token
    summary: Get token history
    description: Get history of all refresh tokens (including revoked) for the current user
    operationId: getTokenHistory
    security:
      - BearerAuth: []
    parameters:
      - name: limit
        in: query
        schema:
          type: integer
          default: 20
          maximum: 100
    responses:
      '200':
        description: Token history
        content:
          application/json:
            schema:
              type: object
              properties:
                userId:
                  type: string
                  format: uuid
                totalTokens:
                  type: integer
                entries:
                  type: array
                  items:
                    type: object
                    properties:
                      id:
                        type: string
                        format: uuid
                      deviceId:
                        type: string
                      deviceName:
                        type: string
                      ipAddress:
                        type: string
                      createdAt:
                        type: string
                        format: date-time
                      expiresAt:
                        type: string
                        format: date-time
                      revoked:
                        type: boolean
                      revokedAt:
                        type: string
                        format: date-time
                      revokedReason:
                        type: string
                      oauthProvider:
                        type: string

# ==================== Extended Session Endpoints ====================

sessions-active:
  get:
    tags:
      - Sessions
    summary: Get active sessions only
    description: Returns only currently active sessions for the authenticated user
    operationId: getActiveSessions
    security:
      - BearerAuth: []
    responses:
      '200':
        description: Active sessions
        content:
          application/json:
            schema:
              type: array
              items:
                $ref: '../schemas/auth.yaml#/ActiveSession'

session-by-id:
  get:
    tags:
      - Sessions
    summary: Get specific session details
    description: Returns detailed information about a specific session
    operationId: getSessionById
    security:
      - BearerAuth: []
    parameters:
      - name: sessionId
        in: path
        required: true
        schema:
          type: string
          format: uuid
    responses:
      '200':
        description: Session details
        content:
          application/json:
            schema:
              $ref: '../schemas/auth.yaml#/ActiveSession'
      '404':
        description: Session not found
        content:
          application/json:
            schema:
              $ref: '../schemas/error.yaml#/Error'

sessions-count:
  get:
    tags:
      - Sessions
    summary: Get active session count
    description: Returns the number of active sessions for the current user
    operationId: getSessionCount
    security:
      - BearerAuth: []
    responses:
      '200':
        description: Session count
        content:
          application/json:
            schema:
              type: object
              properties:
                activeSessions:
                  type: integer

session-activities:
  get:
    tags:
      - Sessions
    summary: Get session activity history
    description: Returns the activity log for a specific session
    operationId: getSessionActivities
    security:
      - BearerAuth: []
    parameters:
      - name: sessionId
        in: path
        required: true
        schema:
          type: string
          format: uuid
    responses:
      '200':
        description: Session activities
        content:
          application/json:
            schema:
              type: array
              items:
                $ref: '../schemas/auth.yaml#/SessionActivity'
      '404':
        description: Session not found
        content:
          application/json:
            schema:
              $ref: '../schemas/error.yaml#/Error'

user-activities:
  get:
    tags:
      - Sessions
    summary: Get all session activities for current user
    description: Returns paginated activity log across all sessions
    operationId: getUserActivities
    security:
      - BearerAuth: []
    parameters:
      - name: page
        in: query
        schema:
          type: integer
          default: 0
      - name: size
        in: query
        schema:
          type: integer
          default: 20
          maximum: 100
    responses:
      '200':
        description: User activities
        content:
          application/json:
            schema:
              type: object
              properties:
                content:
                  type: array
                  items:
                    $ref: '../schemas/auth.yaml#/SessionActivity'
                totalElements:
                  type: integer
                totalPages:
                  type: integer
                number:
                  type: integer
                size:
                  type: integer

session-trust:
  put:
    tags:
      - Sessions
    summary: Mark session as trusted
    description: Marks a session as trusted device, which may affect security checks
    operationId: trustSession
    security:
      - BearerAuth: []
    parameters:
      - name: sessionId
        in: path
        required: true
        schema:
          type: string
          format: uuid
    responses:
      '200':
        description: Session marked as trusted
      '404':
        description: Session not found
        content:
          application/json:
            schema:
              $ref: '../schemas/error.yaml#/Error'

sessions-terminate-other:
  delete:
    tags:
      - Sessions
    summary: Terminate all other sessions
    description: Terminates all sessions except the current one (logout everywhere else)
    operationId: terminateOtherSessions
    security:
      - BearerAuth: []
    responses:
      '200':
        description: All other sessions terminated
        content:
          application/json:
            schema:
              $ref: '../schemas/auth.yaml#/MessageResponse'
